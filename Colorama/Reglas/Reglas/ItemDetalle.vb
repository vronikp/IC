'------------------------------------------------------------------------------
' <auto-generated>
'     This code was generated by a tool.
'     Runtime Version:2.0.50727.42
'
'     Changes to this file may cause incorrect behavior and will be lost if
'     the code is regenerated.
' </auto-generated>
'------------------------------------------------------------------------------

Option Strict Off
Option Explicit On

Imports Infoware.Datos
Imports Infoware.Reglas.General



#Region "ItemDetalle"
Public Class ItemDetalle

  Const _Procedimiento As String = "proc_ItemDetalle"

  Private mItem As Item = Nothing

  Private mSucursal As Sucursal = Nothing

  Private mItemDetalle As Item = Nothing

  Private mPardetUnidadMedida As WWTSParametroDet = Nothing

  Public Sub New(ByVal _Item As Item, ByVal _EsNuevo As Boolean)
    MyBase.New()
    Item = _Item
    OperadorDatos = _Item.OperadorDatos
    EsNuevo = _EsNuevo
  End Sub

  Public Sub New(ByVal _Item As Item, ByVal _Sucursal As Sucursal)
    Me.New(_Item, False)
    Sucursal = _Sucursal
    If Me.Recargar Then
    Else
      Throw New System.Exception("No se puede cargar objeto ItemDetalle")
    End If
  End Sub

  'Item
  Public Overridable Property Item() As Item
    Get
      If Me.mItem Is Nothing AndAlso Item_Codigo > 0 Then
        Me.mItem = New Item(OperadorDatos, Item_Codigo)
      End If
      Return Me.mItem
    End Get
    Set(ByVal value As Item)
      Me.mItem = value
      Item_Codigo = value.Item_Codigo
    End Set
  End Property

  'Sucursal
  Public Overridable Overloads Property Sucursal() As Sucursal
    Get
      If Me.mSucursal Is Nothing AndAlso Sucurs_Codigo > 0 Then
        Me.mSucursal = New Sucursal(New Empresa(OperadorDatos, Me.Empres_Codigo), Me.Sucurs_Codigo)
      End If
      Return Me.mSucursal
    End Get
    Set(ByVal value As Sucursal)
      Me.mSucursal = value
      Empres_Codigo = value.Empres_Codigo
      Sucurs_Codigo = value.Sucurs_Codigo 
    End Set
  End Property

  Public Overridable ReadOnly Property SucursalString() As String
    Get
      If Sucursal Is Nothing Then
        Return String.Empty
      Else
        Return mSucursal.NombreCompleto
      End If
    End Get
  End Property

  'ItemDetalle
  Public Overridable Property ItemDetalle() As Item
    Get
      If Me.mItemDetalle Is Nothing AndAlso mItem_CodigoDetalle > 0 Then
        Me.mItemDetalle = New Item(OperadorDatos, mItem_CodigoDetalle)
      End If
      Return Me.mItemDetalle
    End Get
    Set(ByVal value As Item)
      Me.mItemDetalle = value
      mItem_CodigoDetalle = value.Item_Codigo
    End Set
  End Property

  <Infoware.Reportes.CampoReporteAtributo("Item", Infoware.Reportes.CampoReporteAtributo.EnumTipoDato.Texto, 200, True)> _
  Public ReadOnly Property ItemString() As String
    Get
      If ItemDetalle Is Nothing Then
        Return String.Empty
      Else
        Return ItemDetalle.Item_Descripcion
      End If
    End Get
  End Property

  <Infoware.Reportes.CampoReporteAtributo("Cantidad", Infoware.Reportes.CampoReporteAtributo.EnumTipoDato.Decimales, 80, True)> _
  Public ReadOnly Property Cantidad() As Decimal
    Get
      Return IteDet_Cantidad
    End Get
  End Property

  'WWTSParametroDet
  Public Overridable Property PardetUnidadMedida() As WWTSParametroDet
    Get
      If Me.mPardetUnidadMedida Is Nothing AndAlso Pardet_Unidadmedida > 0 Then
        Me.mPardetUnidadMedida = New WWTSParametroDet(OperadorDatos, Parame_Unidadmedida, Pardet_Unidadmedida)
      End If
      Return Me.mPardetUnidadMedida
    End Get
    Set(ByVal value As WWTSParametroDet)
      Me.mPardetUnidadMedida = value
      Parame_Unidadmedida = value.Parame_Codigo
      Pardet_Unidadmedida = value.Pardet_Secuencia
    End Set
  End Property

  <Infoware.Reportes.CampoReporteAtributo("Unidad medida", Infoware.Reportes.CampoReporteAtributo.EnumTipoDato.Texto, 90, True)> _
  Public ReadOnly Property UnidadMedidaString() As String
    Get
      If PardetUnidadMedida Is Nothing Then
        Return String.Empty
      Else
        Return PardetUnidadMedida.Pardet_Descripcion
      End If
    End Get
  End Property

  <Infoware.Reportes.CampoReporteAtributo("Valor", Infoware.Reportes.CampoReporteAtributo.EnumTipoDato.Decimales, 80, True)> _
  Public ReadOnly Property Valor() As Decimal
    Get
      Return IteDet_Valor
    End Get
  End Property

  <Infoware.Reportes.CampoReporteAtributo("Total", Infoware.Reportes.CampoReporteAtributo.EnumTipoDato.Decimales, 85, True)> _
  Public ReadOnly Property Total() As Decimal
    Get
      Return IteDet_Cantidad * IteDet_Valor
    End Get
  End Property

  Public Overridable Sub MapearDataRowaObjeto(ByVal Fila As DataRow)
    Empres_Codigo = CType(Fila("Empres_Codigo"), Integer)
    Sucurs_Codigo = CType(Fila("Sucurs_Codigo"), Integer)
    Item_Codigo = CType(Fila("Item_Codigo"), Integer)
    IteDet_Secuencia = CType(Fila("IteDet_Secuencia"), Integer)
    Item_CodigoDetalle = CType(Fila("Item_CodigoDetalle"), Integer)
    IteDet_Cantidad = CType(Fila("IteDet_Cantidad"), Decimal)
    Parame_UnidadMedida = CInt(Fila("Parame_UnidadMedida"))
    Pardet_UnidadMedida = CInt(Fila("Pardet_UnidadMedida"))
    IteDet_Valor = CDec(Fila("IteDet_Valor"))
    mItem = Nothing
    mSucursal = Nothing
    mItemDetalle = Nothing
    mPardetUnidadMedida = Nothing
  End Sub

  Public Overridable Function Recargar() As Boolean
    Dim Result As New DataTable
    Dim bReturn As Boolean = True
    OperadorDatos.AgregarParametro("@accion", "C")
    OperadorDatos.AgregarParametro("@Empres_Codigo", Empres_Codigo)
    OperadorDatos.AgregarParametro("@Sucurs_Codigo", Sucurs_Codigo)
    OperadorDatos.AgregarParametro("@Item_Codigo", Item_Codigo)
    OperadorDatos.AgregarParametro("@IteDet_Secuencia", IteDet_Secuencia)
    OperadorDatos.Procedimiento = _Procedimiento
    bReturn = OperadorDatos.Ejecutar(Result)
    OperadorDatos.LimpiarParametros()
    Try
      Me.MapearDataRowaObjeto(Result.Rows(0))
      EsNuevo = False
      EsModificado = False
    Catch ex As System.Exception
      bReturn = False
    End Try
    Return bReturn
  End Function

  Public Overridable Function Guardar() As Boolean
    If Not EsNuevo And Not EsModificado Then
      Return True
    End If

    Dim Result As Integer = 0
    Dim bReturn As Boolean = True
    Dim sAccion As String = "M"
    If EsNuevo Then
      sAccion = "I"
    End If
    OperadorDatos.AgregarParametro("@accion", sAccion)
    OperadorDatos.AgregarParametro("@Empres_Codigo", Empres_Codigo)
    OperadorDatos.AgregarParametro("@Sucurs_Codigo", Sucurs_Codigo)
    OperadorDatos.AgregarParametro("@Item_Codigo", Item_Codigo)
    OperadorDatos.AgregarParametro("@IteDet_Secuencia", IteDet_Secuencia)
    OperadorDatos.AgregarParametro("@Item_CodigoDetalle", Item_CodigoDetalle)
    OperadorDatos.AgregarParametro("@IteDet_Cantidad", IteDet_Cantidad)
    OperadorDatos.AgregarParametro("@Parame_UnidadMedida", Parame_UnidadMedida)
    OperadorDatos.AgregarParametro("@Pardet_UnidadMedida", Pardet_UnidadMedida)
    OperadorDatos.AgregarParametro("@IteDet_Valor", IteDet_Valor)
    OperadorDatos.Procedimiento = _Procedimiento
    bReturn = OperadorDatos.Ejecutar(Result)
    OperadorDatos.LimpiarParametros()
    If bReturn Then
      If EsNuevo Then
        IteDet_Secuencia = Result
      End If

      If Not OperadorDatos.EstaenTransaccion Then
        AceptarCambios()
      End If
    End If
    Return bReturn
  End Function

  Public Overridable Sub AceptarCambios()
    EsNuevo = False
    EsModificado = False
  End Sub

  Public Overridable Function Eliminar() As Boolean
    If EsNuevo Then
      Return True
    End If

    Dim bReturn As Boolean = True
    OperadorDatos.AgregarParametro("@accion", "E")
    OperadorDatos.AgregarParametro("@Empres_Codigo", Empres_Codigo)
    OperadorDatos.AgregarParametro("@Sucurs_Codigo", Sucurs_Codigo)
    OperadorDatos.AgregarParametro("@Item_Codigo", Item_Codigo)
    OperadorDatos.AgregarParametro("@IteDet_Secuencia", IteDet_Secuencia)
    OperadorDatos.Procedimiento = _Procedimiento
    bReturn = OperadorDatos.Ejecutar
    OperadorDatos.LimpiarParametros()
    Return bReturn
  End Function
End Class
#End Region

#Region "ItemDetalleList"
Public Class ItemDetalleList
  Inherits System.ComponentModel.BindingList(Of ItemDetalle)

  Public Shared Function ObtenerLista(ByVal _Item As Item, ByVal _Sucursal As Sucursal) As ItemDetalleList
    Dim oResult As ItemDetalleList = New ItemDetalleList
    Dim bReturn As Boolean
    Dim ds As DataTable = Nothing
    With _Item.OperadorDatos
      .AgregarParametro("@Accion", "F")
      .AgregarParametro("@Empres_Codigo", _Sucursal.Empres_Codigo)
      .AgregarParametro("@Sucurs_Codigo", _Sucursal.Sucurs_Codigo)
      .AgregarParametro("@Item_Codigo", _Item.Item_Codigo)
      .Procedimiento = "proc_ItemDetalle"
      bReturn = .Ejecutar(ds)
      .LimpiarParametros()
    End With
    If bReturn AndAlso Not ds Is Nothing AndAlso ds.Rows.Count > 0 Then
      For Each _dr As DataRow In ds.Rows
        Dim _fila As New ItemDetalle(_Item, False)
        _fila.MapearDataRowaObjeto(_dr)
        oResult.Add(_fila)
      Next
    End If
    Return oResult
  End Function
End Class
#End Region
